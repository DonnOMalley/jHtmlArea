// jHtmlArea - http://jhtmlarea.codeplex.com - (c)2014 Chris Pietschmann
// Updated APR 02 2019 Donn O'Malley
// Updated Sep 02 2019 Donn O'Malley
// Updated Oct 06 2019 Donn O'Malley

!function(t,e){var i=(e.$jhtmlarea={}).browser={};i.msie=!1,i.mozilla=!1,i.safari=!1,i.version=0,navigator.userAgent.match(/MSIE ([0-9]+)\./)?(i.msie=!0,i.version=parseFloat(RegExp.$1)):navigator.userAgent.match(/Trident\/([0-9]+)\./)&&(i.msie=!0,i.version=RegExp.$1,navigator.userAgent.match(/rv:([0-9]+)\./)&&(i.version=parseFloat(RegExp.$1))),navigator.userAgent.match(/Mozilla\/([0-9]+)\./)&&(i.mozilla=!0,0===i.version&&(i.version=parseFloat(RegExp.$1))),navigator.userAgent.match(/Safari ([0-9]+)\./)&&(i.safari=!0,i.version=RegExp.$1,navigator.userAgent.match(/Version\/([0-9]+)\./)&&0===i.version&&(i.version=parseFloat(RegExp.$1))),t.fn.htmlarea=function(t){if(t&&"string"==typeof t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r=n(this[0]),o=r[t];if(o)return o.apply(r,e)}return this.each(function(){n(this,t)})};var n=e.jHtmlArea=function(t,e){return t.jquery?n(t[0]):t.jhtmlareaObject?t.jhtmlareaObject:new n.fn.init(t,e)};n.fn=n.prototype={jhtmlarea:"0.8",init:function(e,i){if("textarea"===e.nodeName.toLowerCase()){var o=t.extend({},n.defaultOptions,i);e.jhtmlareaObject=this;var a=this.textarea=t(e),s=this.container=t("<div/>").addClass("jHtmlArea").width(a.width()).insertAfter(a),h=this.toolbar=t("<div/>").addClass("ToolBar").appendTo(s);r.initToolBar.call(this,o);var c=this.iframe=t("<iframe/>").height(a.height());c.width(a.width());var l=this.htmlarea=t("<div/>").append(c);s.append(l).append(a.hide()),r.initEditor.call(this,o),r.attachEditorEvents.call(this),c.height(c.height()-h.height()),h.width(a.width()),o.loaded&&o.loaded.call(this)}},clear:function(){this.iframe[0].contentWindow.focus(),this.ec("selectAll"),this.getRange().deleteContents(),this.updateTextArea()},dispose:function(){this.textarea.show().insertAfter(this.container),this.container.remove(),this.textarea[0].jhtmlareaObject=null},execCommand:function(t,e,n){if(this.iframe[0].contentWindow.focus(),!0===i.msie&&i.version>=11&&this.previousRange){var r=this.previousRange,o=this.getSelection();o.removeAllRanges(),o.addRange(r)}this.editor.execCommand(t,e||!1,n||null),this.updateTextArea()},ec:function(t,e,i){null!==i&&this.execCommand(t,e,i)},queryCommandValue:function(t){return this.iframe[0].contentWindow.focus(),this.editor.queryCommandValue(t)},qc:function(t){return this.queryCommandValue(t)},getSelectedHTML:function(){if(i.msie)return this.getRange().htmlText;var e=this.getRange().cloneContents();return t("<p/>").append(t(e)).html()},getSelection:function(){return!0===i.msie&&i.version<11?this.editor.selection:this.iframe[0].contentDocument.defaultView.getSelection()},getRange:function(){var t=this.getSelection();return t?t.getRangeAt&&t.rangeCount>0?t.getRangeAt(0):t.createRange?t.createRange():null:null},html:function(t){if(void 0===t)return this.toHtmlString();this.textarea.val(t),this.updateHtmlArea()},pasteHTML:function(t){var e=this.iframe[0].contentWindow;e.focus();var i=this.getRange();null===i?alert("Error attempting to embed html"):(i.deleteContents(),i.insertNode(e.document.createRange().createContextualFragment(t)),this.updateTextArea())},cut:function(){this.ec("cut")},copy:function(){this.ec("copy")},paste:function(){this.ec("paste")},bold:function(){this.ec("bold")},italic:function(){this.ec("italic")},underline:function(){this.ec("underline")},strikeThrough:function(){this.ec("strikethrough")},image:function(t){!0!==i.msie||t?this.ec("insertImage",!1,t||prompt("Image URL:","http://")):this.ec("insertImage",!0)},removeFormat:function(){this.ec("removeFormat",!1,[]),this.unlink()},emaillink:function(){if(!0===i.msie)this.ec("createLink",!0);else{var t=prompt("Email Address:","");null!==t&&this.ec("createLink",!1,"mailto:"+t)}},link:function(){!0===i.msie?this.ec("createLink",!0):this.ec("createLink",!1,prompt("Link URL:","http://"))},unlink:function(){this.ec("unlink",!1,[])},embed:function(){var t=prompt("HTML to Embed","");null!=t&&this.pasteHTML(t)},video:function(){var t=prompt("Video URL To Embed","");if(null!=t){var e="";t.trim().startsWith("http")||t.trim().startsWith("www.")?(t.indexOf("youtube.com/watch?v=")>=0?e=t.replace("watch?v=","embed/"):t.indexOf("youtu.be")>=0?e=t.replace("youtu.be","youtube.com/embed").replace("?t=","?start="):t.indexOf("vimeo.com")>=0&&(e=t.replace("vimeo.com","player.vimeo.com/video")),e='<iframe width="440" height="245" src="'+e+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'):e=t,this.pasteHTML(e)}},orderedList:function(){this.ec("insertorderedlist")},unorderedList:function(){this.ec("insertunorderedlist")},superscript:function(){this.ec("superscript")},subscript:function(){this.ec("subscript")},p:function(){this.formatBlock("<p>")},h1:function(){this.heading(1)},h2:function(){this.heading(2)},h3:function(){this.heading(3)},h4:function(){this.heading(4)},h5:function(){this.heading(5)},h6:function(){this.heading(6)},heading:function(t){this.formatBlock(!0===i.msie?"Heading "+t:"h"+t)},indent:function(){this.ec("indent")},outdent:function(){this.ec("outdent")},insertHorizontalRule:function(){this.ec("insertHorizontalRule",!1,"ht")},justifyLeft:function(){this.ec("justifyLeft")},justifyCenter:function(){this.ec("justifyCenter")},justifyRight:function(){this.ec("justifyRight")},increaseFontSize:function(){!0===i.msie?this.ec("fontSize",!1,this.qc("fontSize")+1):i.safari?this.getRange().surroundContents(t(this.iframe[0].contentWindow.document.createElement("span")).css("font-size","larger")[0]):this.ec("increaseFontSize",!1,"big")},decreaseFontSize:function(){!0===i.msie?this.ec("fontSize",!1,this.qc("fontSize")-1):i.safari?this.getRange().surroundContents(t(this.iframe[0].contentWindow.document.createElement("span")).css("font-size","smaller")[0]):this.ec("decreaseFontSize",!1,"small")},forecolor:function(t){this.ec("foreColor",!1,void 0!==t?t:prompt("Enter HTML Color:","#"))},formatBlock:function(t){this.ec("formatblock",!1,t||null)},showHTMLView:function(){this.updateTextArea(),this.textarea.show(),this.htmlarea.hide(),t("ul li:not(li:has(a.html))",this.toolbar).hide(),t("ul:not(:has(:visible))",this.toolbar).hide(),t("ul li a.html",this.toolbar).addClass("highlighted")},hideHTMLView:function(){this.updateHtmlArea(),this.textarea.hide(),this.htmlarea.show(),t("ul",this.toolbar).show(),t("ul li",this.toolbar).show().find("a.html").removeClass("highlighted")},toggleHTMLView:function(){this.textarea.is(":hidden")?this.showHTMLView():this.hideHTMLView()},toHtmlString:function(){return this.editor.body.innerHTML},toString:function(){return this.editor.body.innerText},updateTextArea:function(){this.textarea.val(this.toHtmlString())},updateHtmlArea:function(){this.editor.body.innerHTML=this.textarea.val()}},n.fn.init.prototype=n.fn,n.defaultOptions={toolbar:[["html"],["bold","italic","underline","strikethrough","|","subscript","superscript"],["increasefontsize","decreasefontsize"],["orderedlist","unorderedlist"],["indent","outdent"],["justifyleft","justifycenter","justifyright"],["emaillink","link","unlink","image","embed","video","horizontalrule"],["p","h1","h2","h3","h4","h5","h6"],["cut","copy","paste"]],css:null,toolbarText:{bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strike-Through",cut:"Cut",copy:"Copy",paste:"Paste",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",p:"Paragraph",indent:"Indent",outdent:"Outdent",horizontalrule:"Insert Horizontal Rule",justifyleft:"Left Justify",justifycenter:"Center Justify",justifyright:"Right Justify",increasefontsize:"Increase Font Size",decreasefontsize:"Decrease Font Size",forecolor:"Text Color",emaillink:"Email Link",link:"Insert Link",unlink:"Remove Link",image:"Insert Image",embed:"Insert Embedded Html",video:"Insert Video Link",orderedlist:"Insert Ordered List",unorderedlist:"Insert Unordered List",subscript:"Subscript",superscript:"Superscript",html:"Show/Hide HTML Source View"}};var r={toolbarButtons:{strikethrough:"strikeThrough",orderedlist:"orderedList",unorderedlist:"unorderedList",horizontalrule:"insertHorizontalRule",justifyleft:"justifyLeft",justifycenter:"justifyCenter",justifyright:"justifyRight",increasefontsize:"increaseFontSize",decreasefontsize:"decreaseFontSize",html:function(t){this.toggleHTMLView()}},initEditor:function(t){var e=this.editor=this.iframe[0].contentWindow.document;if(e.designMode="on",e.open(),e.write(this.textarea.val()),e.close(),t.css){var i=e.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t.css,e.getElementsByTagName("head")[0].appendChild(i)}},initToolBar:function(e){var i=this,n=function(e,n,r){return t("<li/>").append(t("<a href='javascript:void(0);'/>").addClass(e).attr("title",n).click(function(){r.call(i,t(this))}))};function o(o){for(var a=t("<ul/>").appendTo(i.toolbar),s=0;s<o.length;s++){var h=o[s];if("string"===(typeof h).toLowerCase())if("|"===h)a.append(t('<li class="separator"/>'));else{var c=function(t){var e=r.toolbarButtons[t]||t;return"function"===(typeof e).toLowerCase()?function(t){e.call(this,t)}:function(){this[e](),this.editor.body.focus()}}(h.toLowerCase()),l=e.toolbarText[h.toLowerCase()];a.append(n(h.toLowerCase(),l||h,c))}else a.append(n(h.css,h.text,h.action))}}if(0!==e.toolbar.length&&r.isArray(e.toolbar[0]))for(var a=0;a<e.toolbar.length;a++)o(e.toolbar[a]);else o(e.toolbar)},attachEditorEvents:function(){var e=this,i=function(){e.updateHtmlArea()};this.textarea.click(i).keyup(i).keydown(i).mousedown(i).blur(i),this.iframe.blur(function(){e.previousRange=e.getRange()});var n=function(){e.updateTextArea()};t(this.editor.body).click(n).keyup(n).keydown(n).mousedown(n).blur(n)},isArray:function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice&&!t.propertyIsEnumerable("length")}}}(jQuery,window);